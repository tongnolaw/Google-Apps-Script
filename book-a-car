//‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°
function onFormSubmit() {
  
  var token1 = ["ryRfQuJjhxL96QH5bCTDzze7YU3PXGm7zzfA9jXgx5N"];//‡πÇ‡∏ó‡πÄ‡∏Ñ‡πà‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥1 ‡∏û‡∏£‡∏∞‡∏ô‡πÄ‡∏£‡∏®
  // var token1 = ["4Yms4F8xCHtjTLUcArH7qKyCue4SWWG8RFPgVFP8la1"];//‡πÇ‡∏ó‡πÄ‡∏Ñ‡πà‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏ï‡∏á
  var token2 = ["4Yms4F8xCHtjTLUcArH7qKyCue4SWWG8RFPgVFP8la1"];//‡πÇ‡∏ó‡πÄ‡∏Ñ‡πà‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥2 ‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏û‡∏£‡∏°‡∏™‡∏£‡∏£

  var form = FormApp.openById('12-zDPIuaF-17-XJQhoExNmbiqPqCQC0KyS4b6nXskrA'); 
  var fRes = form.getResponses();
  var formResponse = fRes[fRes.length - 1];
  var itemResponses = formResponse.getItemResponses();
  
  var ss = SpreadsheetApp.openById('1Omza-YTSMuDCoCNtfekuiK1Domk2Poo97XE9isWR7K0');
  var sheet = ss.getSheetByName('‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° 1');
  var row = sheet.getActiveRange().getLastRow()+1;
  // var row = 1;

  //‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 1
   var dynamicList = ss.getSheetByName('Options').getRange('A2:A4');
   var rangeRule = SpreadsheetApp.newDataValidation().requireValueInRange(dynamicList).build();
   sheet.getRange(row,11).setDataValidation(rangeRule); //‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Ñ‡∏∑‡∏≠ 11

  //‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏™‡∏≤‡∏£‡∏ñ‡∏µ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 1
   var dynamicList2 = ss.getSheetByName('Options').getRange('B2:B5');
   var rangeRule2 = SpreadsheetApp.newDataValidation().requireValueInRange(dynamicList2).build();
   sheet.getRange(row,5).setDataValidation(rangeRule2); //‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ñ‡∏µ ‡∏Ñ‡∏∑‡∏≠ 5

   //‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏£‡∏ñ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏µ‡∏ï‡πÅ‡∏ú‡πà‡∏ô 1
   var dynamicList2 = ss.getSheetByName('Options').getRange('C2:C5');
   var rangeRule2 = SpreadsheetApp.newDataValidation().requireValueInRange(dynamicList2).build();
   sheet.getRange(row,3).setDataValidation(rangeRule2); //‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ ‡∏Ñ‡∏∑‡∏≠ 3
  
  var msg = '\n'+
  '' +itemResponses[0].getResponse() + ' : ‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' +'\n'+ 
  '‡∏£‡∏ñ: ' +itemResponses[1].getResponse()+'\n'+
  '‡πÄ‡∏û‡∏∑‡πà‡∏≠: ' +itemResponses[2].getResponse()+'\n'+
  '‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö: ' +itemResponses[3].getResponse()+'\n'+ 
  '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà: ' +itemResponses[4].getResponse()+'\n'+ 
  '‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà: ' +itemResponses[5].getResponse()+'\n'+ 
  '‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ: ' +itemResponses[6].getResponse()+'\n'+ 
  '‡∏Å‡∏•‡∏±‡∏ö: ' +itemResponses[7].getResponse()+'\n'+ 
  'Tel. ' +itemResponses[8].getResponse()+'\n'+ 
  '‡∏Å‡∏≥‡∏•‡∏±‡∏á '+itemResponses[9].getResponse()+'\n'+ 
  ss.getUrl();;

  sendLineNotify(msg,token1);
  sendLineNotify(msg,token2);
}

function sendLineNotify(message,token) {
  var options = {
    "method": "post",
    "payload": "message=" + message,
    "headers": {
    "Authorization": "Bearer " + token }
};

UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);
}

//‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏µ‡∏ï
function approve() {
   var token3 = "UfWQXYcxIOlfBW6EeTrmohh5z62x0LiMOVsYLlNgtXs";//‡πÇ‡∏ó‡πÄ‡∏Ñ‡πà‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡∏ï‡πÉ‡∏ô
  //  var token3 = "4Yms4F8xCHtjTLUcArH7qKyCue4SWWG8RFPgVFP8la1";//‡πÇ‡∏ó‡πÄ‡∏Ñ‡πà‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏á
   var ss = SpreadsheetApp.getActiveSpreadsheet();
   var sheet = ss.getActiveSheet();
   var row = sheet.getActiveRange().getRow();
   var cellvalue = sheet.getActiveCell().getValue().toString();
  
   
  //  var date = Utilities.formatDate(new Date(), "GMT+7", "dd/MM/");
  //  var year = Number(Utilities.formatDate(new Date(), "GMT+7", "yyyy"));
  //  var thaiyear = Number(Utilities.formatDate(new Date(), "GMT+7", "yyyy"))+543;
   //var time = Utilities.formatDate(new Date(), "GMT+7", "HH:mm");

  var name = sheet.getRange(row, 2).getValue();
  var car = sheet.getRange(row, 3).getValue();
  var objective = sheet.getRange(row, 4).getValue();
  var driver = sheet.getRange(row, 5).getValue();
  var start  = sheet.getRange(row, 6).getValue();
  var destination = sheet.getRange(row, 7).getValue();
  var startDate = new Date(sheet.getRange(row, 8).getValue());
  var endDate = new Date(sheet.getRange(row, 9).getValue());
  var phone = sheet.getRange(row, 10).getValue();
  
  var startDateOnly = Utilities.formatDate(startDate, "GMT+7", "d/MM/yyyy");
  var endDateOnly = Utilities.formatDate(endDate, "GMT+7", "d/MM/yyyy");
  var startTime = Utilities.formatDate(startDate, "GMT+7", "H.mm");
  var endTime = Utilities.formatDate(endDate, "GMT+7", "H.mm");

  if(startDateOnly == endDateOnly){
    var message = '\n'+cellvalue+' ‡∏£‡∏ñ '+car+'\n\n'+
                  '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: '+startDateOnly+'\n'+
                  '‡πÄ‡∏ß‡∏•‡∏≤: '+startTime+'-'+endTime+' ‡∏ô.'+'\n'+
                  '‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: '+name+'\n'+
                  '‡πÇ‡∏ó‡∏£: '+phone+'\n'+
                  '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà: '+start+'\n'+
                  '‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà: '+destination+'\n'+
                  '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: '+objective+'\n'+
                  '‡∏™‡∏≤‡∏£‡∏ñ‡∏µ: '+driver+'\n\n'+
                  // '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏• :'+ date+year+'\n'+
                  '¬© beta version';
  }else{
    var message = '\n'+cellvalue+' ‡∏£‡∏ñ '+car+'\n\n'+
                  '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: '+startDateOnly+'\n'+
                  '‡πÄ‡∏ß‡∏•‡∏≤: '+startTime+' ‡∏ô.'+'\n'+
                  '‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: '+endDateOnly+'\n'+
                  '‡πÄ‡∏ß‡∏•‡∏≤: '+endTime+' ‡∏ô.'+'\n'+
                  '‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: '+name+'\n'+
                  '‡πÇ‡∏ó‡∏£: '+phone+'\n'+
                  '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà: '+start+'\n'+
                  '‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà: '+destination+'\n'+
                  '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: '+objective+'\n'+
                  '‡∏™‡∏≤‡∏£‡∏ñ‡∏µ: '+driver+'\n\n'+
                  // '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏• :'+ date+year+'\n'+
                  '¬© beta version';
  }

  //Creates a calendar event using the submitted data
  var calendar = CalendarApp.getCalendarById("a9nq5jn4sodujcdkl0h47gimu8@group.calendar.google.com");
  var titles = (car + '['+ driver+']');
  var descriptions =  '‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: '+name+'\n'+
                      '‡πÇ‡∏ó‡∏£: '+phone+'\n'+
                      '‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà: '+start+'\n'+
                      '‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà: '+destination+'\n'+                        
                      '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: '+objective+'\n'+
                      '‡∏™‡∏≤‡∏£‡∏ñ‡∏µ: '+driver;

  if (cellvalue == 'üö´‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' ) {

    sendLineNotify(message, token3);

  }else if(cellvalue == '‚úÖ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'){
  
    sendLineNotify(message, token3);
    var event = calendar.createEvent(titles, startDate, endDate, {description: descriptions});
    
    if(car == 'üöö‡∏ö‡∏© 9972'){
      event.setColor (CalendarApp.EventColor.RED);
    }else if(car == 'üöô‡∏Ç‡∏Å 8025'){
      event.setColor (CalendarApp.EventColor.YELLOW);
    }else if(car == 'üöó‡∏ú‡∏à 1072'){
      event.setColor (CalendarApp.EventColor.GREEN);
    }else if(car == 'üöò1‡∏Ç‡∏Æ 7655'){
      event.setColor (CalendarApp.EventColor.BLUE);
    }

  }
  
}
